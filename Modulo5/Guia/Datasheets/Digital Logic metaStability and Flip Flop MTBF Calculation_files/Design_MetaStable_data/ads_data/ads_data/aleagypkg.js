!function(t){function e(s){if(i[s])return i[s].exports;var n=i[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var i={};e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:s})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=7)}([function(t,e){var i={isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},isObject:function(t){return"[object Object]"===Object.prototype.toString.call(t)},isInt:function(t){return parseInt(t,10)===t},floor10:function(t){return t=+t,isNaN(t)?NaN:(t=t.toString().split("e"),t=Math.floor(+(t[0]+"e"+(t[1]?+t[1]+1:1))),t=t.toString().split("e"),+(t[0]+"e"+(t[1]?+t[1]-1:-1)))},truncate:function(t,e){return(""+t).substr(0,e)+"&tr="+t.length},getUid:function(){return Date.now().toString(36)+"-"+(1e18*Math.random()).toString(36)},merge:function(t,e){var i=arguments.length;if(i<2||null==t)return t;for(var s=1;s<i;s++){var n=arguments[s];if(null!=n)for(var o in n)n.hasOwnProperty(o)&&(t[o]&&this.isObject(n[o])?this.merge.call(this,t[o],n[o]):t[o]=n[o])}return t},inArray:Array.prototype.indexOf?function(t,e){return t.indexOf(e)>-1}:function(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return!0;return!1},compareNumbersAsc:function(t,e){return t-e},compareNumbersDesc:function(t,e){return e-t},getOpacity:function(t){if(!t)return 1;var e,i,s,n;return e="getComputedStyle"in window?window.getComputedStyle(t,null):t.style,i="opacity"in e?e.opacity:1,"backgroundColor"in e&&(s=e.backgroundColor.replace(/\s+/g,"")),n="transparent"==s?0:/^rgba/.test(s)?(s.match(/[\d\.]+/g)||[])[3]:1,i*n},contains:void 0!==window.document.documentElement.compareDocumentPosition?function(t,e){return!!(16&t.compareDocumentPosition(e))}:void 0!==window.document.documentElement.contains?function(t,e){return t!==e&&!!t.contains&&t.contains(e)}:function(t,e){for(;e=e.parentNode;)if(e===t)return!0;return!1},matchesSelector:function(){var t=Element.prototype.matches||Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector;return function(e,i){return t.call(e,i)}}(),deepMap:function(t,e,i){if(this.isArray(t))return t.map(function(t,s){return this.isArray(t)||this.isObject(t)?this.deepMap.call(this,t,e,i):e.call(i,t,s)},this);if(this.isObject(t)){var s={};for(var n in t)if(t.hasOwnProperty(n)){var o=t[n];s[n]=this.isArray(o)||this.isObject(o)?this.deepMap.call(this,o,e,i):e.call(i,o,n)}return s}return t}};t.exports=i},function(t,e,i){function s(){if(o.window.adlgdrgn&&o.window.adlgdrgn["2c546d8"]&&o.window.adlgdrgn["2c546d8"].metaController)return o.window.adlgdrgn["2c546d8"].metaController;this.DEFAULT_CHANNEL="adledge",this.BROADCAST_CHANNEL=".*",this.id=n.getUid(),this.sessions={},this.subscriptions={},this.clients={},this.boundReceiveMessage=this.receiveMessage.bind(this),this.iframeAuid={},o.window.addEventListener("message",this.boundReceiveMessage,!1),o.window.document.addEventListener("readystatechange",function(t){var e=o.window.document.readyState;switch(o.onReadystatechange.call(o,t),e){case"loading":this.publish({topic:"page:loading",data:o.page});break;case"interactive":this.publish({topic:"page:interactive",data:o.page});break;case"complete":o.onPageload.call(o,t),this.publish({topic:"page:load",data:o.page})}}.bind(this)),document.addEventListener(o.VISIBILITYCHANGE_EVENT,function(t){o.onVisibilitychange.call(o,t),this.publish({topic:"page:visibility:change:"+o.page.visibilityState,data:o.page})}.bind(this),!1);var t=function(t){o.onPageunload.call(o,t),this.publish({topic:"page:unload",data:t})};o.window.addEventListener("beforeunload",t.bind(this),!1),o.window.addEventListener("pagehide",t.bind(this),!1),o.window.addEventListener("unload",t.bind(this),!1),o.window.adlgdrgn||(o.window.adlgdrgn={}),o.window.adlgdrgn["2c546d8"]||(o.window.adlgdrgn["2c546d8"]={}),o.window.adlgdrgn["2c546d8"].metaController=this}var n=i(0),o=i(2).getInstance();s.getInstance=function(){return o.window.adlgdrgn&&o.window.adlgdrgn["2c546d8"]&&o.window.adlgdrgn["2c546d8"].metaController||new s},s.prototype.subscribe=function(t){var e=t.channel||this.DEFAULT_CHANNEL,i=t.topics||[].concat(t.topic),s=t.callback,n=t.context,o=t.once;return this.subscriptions[e]||(this.subscriptions[e]={}),i.forEach(function(t){this.subscriptions[e][t]||(this.subscriptions[e][t]=[]),this.subscriptions[e][t].push({channel:e,topic:t,context:n,callback:s,once:o})},this),!0},s.prototype.barrier=function(t){var e=t.channel||this.DEFAULT_CHANNEL,i=t.topics,s=t.callback,n=t.context,o=t.once,r=t.timeout,a=t.async,h=i.length,c={};r&&setTimeout(function(){this.unsubscribe({channel:e,topics:i}),s.call(n,c,{channel:e,topics:i,subscription:{channel:e,topics:i},timeStamp:Date.now()})}.bind(this),r);for(var d=function(t,o){c[o.topic]=t,0==--h&&s.call(n,c,{channel:e,topics:i,subscription:{channel:e,topics:i},timeStamp:Date.now()})},l=i.length;l--;)this.subscribe({channel:e,topic:i[l],context:n,callback:d,once:o,async:a});return!0},s.prototype.unsubscribe=function(t){var e=t.channel||this.DEFAULT_CHANNEL,i=t.topics||[].concat(t.topic),s=t.callback;this.subscriptions[e]&&i.forEach(function(t){if(this.subscriptions[e][t])for(var i=this.subscriptions[e][t].length;i--;)this.subscriptions[e][t][i].callback===s&&this.subscriptions[e][t].splice(i,1)},this)},s.prototype.publish=function(t){var e=t.channel||this.DEFAULT_CHANNEL,i=t.topic,s=t.data;for(var n in this.subscriptions)if(new RegExp(n).test(e))for(var r in this.subscriptions[n])if(new RegExp(r).test(i))for(var a=this.subscriptions[n][r].length;a--;){var h=this.subscriptions[n][r][a],c={channel:e,topic:i,subscription:{channel:n,topic:r},timeStamp:Date.now()};h.async?o.window.setTimeout(h.callback.bind(h.context,s,c),0):h.callback.call(h.context,s,c),h.once&&this.subscriptions[n][r].splice(a,1)}return!0},s.prototype.receiveMessage=function(t){if((t.origin||t.originalEvent.origin)===this.iframeAuid.origin){var e={};try{e=JSON.parse(t.data)}catch(t){return}"adledge"===e.channel&&"metaController:auid"===e.topic&&(o.window.removeEventListener("message",this.boundReceiveMessage,!1),o.window.document.body.removeChild(this.iframeAuid.node),this.auid=e.auid,this.publish({topic:"metaController:auid",data:this.auid}))}},s.prototype.getAuid=function(t){if(this.auid)return this.publish({topic:"metaController:auid",data:this.auid});this.iframeAuid.origin||(this.iframeAuid.origin="https://"+t.session.config.current.host.auid,this.iframeAuid.src=this.iframeAuid.origin+"/iframeauid.html",this.iframeAuid.node=o.window.document.createElement("iframe"),this.iframeAuid.node.className="adlgdrgnexc",this.iframeAuid.node.width=1,this.iframeAuid.node.height=1,this.iframeAuid.node.frameborder=0,this.iframeAuid.node.allowtransparency=!0,this.iframeAuid.node.style.position="absolute",this.iframeAuid.node.style.left="0",this.iframeAuid.node.style.top="0",this.iframeAuid.node.style.border="0 none",this.iframeAuid.node.src=this.iframeAuid.src,o.window.document.body.appendChild(this.iframeAuid.node))},t.exports=s},function(t,e,i){function s(){if(o.adlgdrgn&&o.adlgdrgn["2c546d8"]&&o.adlgdrgn["2c546d8"].environment)return o.adlgdrgn["2c546d8"].environment;this.window=o,this.hasTopAccess=r,this.HIDDEN_PROPERTY="hidden"in this.window.document?"hidden":"webkitHidden"in this.window.document?"webkitHidden":"mozHidden"in this.window.document?"mozHidden":"msHidden"in this.window.document?"msHidden":null,this.VISIBILITYSTATE_PROPERTY="visibilityState"in this.window.document?"visibilityState":"webkitVisibilityState"in this.window.document?"webkitVisibilityState":"mozVisibilityState"in this.window.document?"mozVisibilityState":null,this.VISIBILITYCHANGE_EVENT="hidden"in this.window.document?"visibilitychange":"webkitHidden"in this.window.document?"webkitvisibilitychange":"mozHidden"in this.window.document?"mozvisibilitychange":"msHidden"in this.window.document?"msvisibilitychange":null,this.browser=this.getBrowserInfo(),this.page={visibilityState:this.getPageVisibilityState(),isHidden:this.window.document[this.HIDDEN_PROPERTY],isVisible:!this.window.document[this.HIDDEN_PROPERTY],readyState:this.window.document.readyState,isLoaded:"complete"===this.window.document.readyState},this.window.adlgdrgn||(this.window.adlgdrgn={}),this.window.adlgdrgn["2c546d8"]||(this.window.adlgdrgn["2c546d8"]={}),this.window.adlgdrgn["2c546d8"].environment=this}var n=i(0),o=window,r=!1;try{window.top.document&&(o=window.top,r=!0)}catch(t){}s.getInstance=function(){return o.adlgdrgn&&o.adlgdrgn["2c546d8"]&&o.adlgdrgn["2c546d8"].environment||new s},s.prototype.getFlashPluginInfo=function(){var t,e={enabled:!1,version:{raw:"",major:"",minor:"",revision:""}},i="";try{i=this.window.navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin.description}catch(t){try{i=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(t){}}return t=i.match(/(\d+)/g)||[],t.length&&(e.enabled=!0,e.version={raw:i,major:t[0]||"",minor:t[1]||"",revision:t[2]||""}),e},s.prototype.getBrowserInfo=function(){var t,e,i,s={language:this.window.navigator.userLanguage||this.window.navigator.language,userAgent:this.window.navigator.userAgent,userAgentInduced:{device:{is:{mobile:/Mobi/.test(this.window.navigator.userAgent)}}},featuresInduced:[],is:{}},n=this.window.document.createElement("div");return/opera|opr/i.test(s.userAgent)?(s.userAgentInduced.name="opera",e=s.userAgent.match(/\sopr\/([\w\.]+)/i)||s.userAgent.match(/opera.+version\/([\w\.]+)/i)):/msie|trident/i.test(s.userAgent)?(s.userAgentInduced.name="ie",e=s.userAgent.match(/trident.+rv[:\s]([\w\.]+).+like\sgecko/i)||s.userAgent.match(/(?:ms|\()ie\s([\w\.]+)/i)):/chrome.+? edge/i.test(s.userAgent)?(s.userAgentInduced.name="edge",e=s.userAgent.match(/edge\/((\d+)?[\w\.]+)/i)):/chrome|crios|crmo/i.test(s.userAgent)?(s.userAgentInduced.name="chrome",e=s.userAgent.match(/chrome\/v?([\w\.]+)/i)):/firefox/i.test(s.userAgent)?(s.userAgentInduced.name="firefox",e=s.userAgent.match(/firefox\/([\w\.-]+)/i)):/safari/i.test(s.userAgent)&&(s.userAgentInduced.name="safari",e=s.userAgent.match(/version\/([\w\.]+).+?(?:mobile\s?safari|safari)/i)),e&&void 0!==e[1]&&(s.userAgentInduced.version={raw:e[1]},i=s.userAgentInduced.version.raw.split("."),s.userAgentInduced.version.major=+i[0],s.userAgentInduced.version.minor=+i[1]),"InstallTrigger"in this.window&&(t=new Object({name:"firefox"}),s.featuresInduced.push(t)),(this.window.opr&&this.window.opr.addons||this.window.opera)&&(t=new Object({name:"opera"}),s.featuresInduced.push(t)),(Object.prototype.toString.call(this.window.HTMLElement).indexOf("Constructor")>0||"webkitFlowInto"in n.style&&"webkitFlowFrom"in n.style)&&(t=new Object({name:"safari"}),s.featuresInduced.push(t)),this.window.chrome&&this.window.chrome.webstore&&(t=new Object({name:"chrome"}),s.featuresInduced.push(t)),"documentMode"in this.window.document&&(t=new Object({name:"ie",version:{}}),this.window.document.compatMode&&(t.version.major=6),this.window.XMLHttpRequest&&(t.version.major=7),this.window.document.querySelector&&(t.version.major=8),this.window.document.addEventListener&&(t.version.major=9),this.window.atob&&(t.version.major=10),this.window.ActiveXObject||(t.version.major=11),s.featuresInduced.push(t)),!this.window.document.documentMode&&this.window.StyleMedia&&(t=new Object({name:"edge"}),s.featuresInduced.push(t)),s.hasIdentifiableFeatures=s.featuresInduced.length>0,s.hasExclusiveFeatures=1===s.featuresInduced.length,s.hasExclusiveFeatures&&(t=s.featuresInduced[0],s.name=t.name,s.hasAmbiguousClaims=s.userAgentInduced.name!==s.name,!s.hasAmbiguousClaims&&t.version&&t.version.major===s.userAgentInduced.version.major&&(s.version=t.version)),s.is[s.name]=!0,s.plugins={},s.plugins.flash=this.getFlashPluginInfo(),s},s.prototype.getPerformanceTiming=function(){if(!("performance"in this.window&&"timing"in this.window.performance))return{};if("toJSON"in this.window.performance.timing)return this.window.performance.timing.toJSON();var t={};return["navigationStart","unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd"].forEach(function(e){var i=this.window.performance.timing[e];void 0!==i&&(t[e]=i)}),t},s.prototype.getScreenRect=function(){return{left:0,top:0,right:(this.window.screen.left||this.window.screen.availLeft||0)+this.window.screen.availWidth,bottom:(this.window.screen.top||this.window.screen.availTop||0)+this.window.screen.availHeight,width:this.window.screen.availWidth,height:this.window.screen.availHeight}},s.prototype.getAppRect=function(){return{left:this.window.screenX,top:this.window.screenY,right:this.window.screenX+(this.window.outerWidth||this.window.innerWidth),bottom:this.window.screenY+(this.window.outerHeight||this.window.innerHeight),width:this.window.outerWidth,height:this.window.outerHeight}},s.prototype.getPageVisibilityState=function(){return this.window.document[this.VISIBILITYSTATE_PROPERTY]},s.prototype.onReadystatechange=function(){this.page.readyState=this.window.document.readyState},s.prototype.onPageload=function(){this.page.isLoaded=!0},s.prototype.onPageunload=function(){this.page.isLoaded=!1},s.prototype.onVisibilitychange=function(){n.merge(this.page,{visibilityState:this.getPageVisibilityState(),isHidden:this.window.document[this.HIDDEN_PROPERTY],isVisible:!this.window.document[this.HIDDEN_PROPERTY]})},s.prototype.getPageText=function(){if(!this.hasTopAccess)return"";var t=(this.window.document.title||"")+" "+this.window.location.href;if(this.window.document.body){for(var e=this.window.document.body.cloneNode(!0),i=e.querySelectorAll("script, style"),s=0,n=i.length;s<n;s++){var o=i[s];o.parentNode.removeChild(o)}t+=e.textContent.replace(/<[^>]+?>/g," ")}for(var r=this.window.document.querySelectorAll("meta"),s=0,n=r.length;s<n;s++){var a=r[s];a.hasAttribute("name")&&"description"===a.getAttribute("name")&&a.hasAttribute("content")&&(t+=" "+a.getAttribute("content"))}return this.page.text=t.replace(/\s+/g," ").toLowerCase().trim()},t.exports=s},function(t,e,i){function s(t){t||(t={}),this.name="RequestError",this.type=t.type||"error",this.message=t.message||"Request Error",this.stack=(new Error).stack}function n(t,e,i){var n={contentType:"text/plain",responseType:"",context:null};if("function"==typeof e&&(i=e,e={}),"function"!=typeof i&&(i=function(){}),!t)return i(new s({type:"url",message:"no url arguments"}),this);if(e=o.merge({},n,e||{}),this.url=t,this.contentType=e.contentType,this.responseType=e.responseType.toLowerCase(),this.accept=e.accept,this.context=e.context,this.method=e.method.toLowerCase(),this.type=e.type,this.async=e.async,"pixel"!==this.type&&"sendBeacon"!==this.type||(this.async=!0),this.data=e.data,this.data&&(this.data.req=this.toJSON(),delete this.data.req.m,this.data=JSON.stringify(o.deepMap(this.data,encodeURIComponent))),"get"===this.method&&this.data&&(this.url+=(/\?/.test(this.url)?"&":"?")+"d="+this.data),"get"===this.method&&"pixel"===this.type){var r=new Image;r.onerror=i.bind(this.context,new s({type:"pixel",message:"pixel error"}),this),r.onabort=i.bind(this.context,new s({type:"pixel",message:"pixel abort"}),this),r.onload=i.bind(this.context,null,this),r.src=this.url}else if("post"===this.method&&"sendBeacon"===this.type){var a=window.navigator.sendBeacon(this.url,this.data);a?i.call(this.context,null,this):i.call(this.context,new s({type:"sendBeacon",message:"sendBeacon queue error"}),this)}else if("xhr"===this.type){var h=this.getXhr();if(!h)return;h.onerror=i.bind(this.context,new s({type:"xhr",message:"xhr error"}),this),h.onabort=i.bind(this.context,new s({type:"xhr",message:"xhr abort"}),this),h.onload=function(){switch(h.status){case 404:i.call(this.context,new s({type:"xhr",message:"404"}),this);break;case 0:i.call(this.context,new s({type:"xhr",message:"xhr.status / "+h.statusText}),this);break;default:if(this.response=h.responseText,"json"===this.responseType)try{this.response=JSON.parse(this.response)}catch(t){return i.call(this.context,new s({type:"xhr",message:"responseType is 'json' but response failed to be parsed as json"}),this)}i.call(this.context,null,this)}}.bind(this),h.open(this.method,this.url,this.async),"setRequestHeader"in h&&(this.contentType&&h.setRequestHeader("Content-Type",this.contentType),this.accept&&h.setRequestHeader("Accept",this.accept)),h.send("post"===this.method?this.data:null)}else i.call(this.context,new s({type:"xhr",message:"incompatible method and type"}),this)}var o=i(0);s.prototype=Object.create(Error.prototype),s.prototype.constructor=s,n.prototype.getXhr=function(){return"XDomainRequest"in window?new XDomainRequest:"XMLHttpRequest"in window?new XMLHttpRequest:void 0},n.prototype.toJSON=function(){var t={m:this.method,a:+this.async};switch(this.type){case"pixel":t.t="px";break;case"xhr":t.t="xhr";break;case"sendBeacon":t.t="sb"}return t},t.exports=n},function(t,e){function i(t){this.top=t.top,this.right=t.right,this.bottom=t.bottom,this.left=t.left,this.width=t.width||t.right-t.left,this.height=t.height||t.bottom-t.top}i.getRect=function(t){var e={};return t&&t.getBoundingClientRect&&(e=t.getBoundingClientRect()),new i(e)},i.getArea=function(t){return t.width*t.height},i.prototype.getArea=function(){return this.width*this.height},i.getIntersectionRect=function(t,e){var i={left:Math.max(t.left,e.left),right:Math.min(t.right,e.right),bottom:Math.min(t.bottom,e.bottom),top:Math.max(t.top,e.top)};return i.width=Math.max(0,i.right-i.left),i.height=Math.max(0,i.bottom-i.top),i},i.getIntersectionArea=function(t,e){var s=i.getIntersectionRect(t,e);return s.width*s.height},i.equals=function(t,e,i){return i=i||0,Math.abs(e.left-t.left)<=i&&Math.abs(e.top-t.top)<=i&&Math.abs(e.right-t.right)<=i&&Math.abs(e.bottom-t.bottom)<=i},t.exports=i},function(t,e){t.exports={id:"qsdk76",protocol:"https:",host:{cdn:"rs.adledge.com",res:"rs2.adledge.com",epn:"epn.adledge.com",vid:"vid.adledge.com",ser:"ser.adledge.com",auid:"auid.adledge.com",vpx:"vpx.adledge.com"},data:{flush:{enabled:!0,path:"/v15/",url:"https://epn.adledge.com/v15/",request:{method:"post",type:"xhr",async:!0},events:["log:fatal","log:error","config:complete","ad:measure:init","ad:viewability:iab","data:flush(?::iteration)?:disabled","page:unload"],iteration:{enabled:!0,getInterval:"if (n === 0) return 1E3;if (n === 1) return 4E3;if (n >= 2 && n < 13) return 5*60E3; if (n >= 13) return;"}},truncation:{"^hurl":2e3,"^iurl":1e3,"^url\\d+":300}},ad:{container:{search:{count:{max:2},scriptTextLength:{max:2500},interval:250}},creative:{iab:{units:{160:[600],180:[150],300:[250,600,1050],728:[90],970:[90,250]}},display:{selector:"img, iframe:not([class~=adlgdrgnexc]), object, embed"},video:{selector:"object, embed, video"},width:{min:80,max:"Infinity"},height:{min:30,max:"Infinity"}},search:{count:{max:60},interval:800},measure:{enabled:!0,iab:{display:{standard:{pixels:{percentage:{min:50}},duration:{min:1e3}},large:{pixels:{threshold:242500,percentage:{min:30}},duration:{min:1e3}}},video:{standard:{pixels:{percentage:{min:50}},duration:{min:2e3}},large:{pixels:{threshold:242500,percentage:{min:30}},duration:{min:2e3}}}},interval:100}},brandSafety:{mask:{enabled:!0},scan:{enabled:!0},webService:{path:"/fw/url_status.php",url:"https://ser.adledge.com/fw/url_status.php'"},apriori:["3814","3848","3877","3897","3916"],getPageTextTimeout:1e3},ivt:{timingsListLimit:50}}},function(t,e,i){function s(t){this.windows=[],this.encapsulationLevel=-1,this.isUnderXDomain=!1,this.urls=[],this.refs=[];var e=t.window,i=t.window;do{this.encapsulationLevel++,this.lastIframeWindow=i,this.isInPopup=this.isInPopup||null!=e.opener;var s={};try{s.object=e,s.url=e.location.toString(),s.protocol=e.location.protocol,this.highestWindow=e,this.highestUrl=s.url}catch(t){this.isUnderXDomain=!0}try{s.referrer=e.document.referrer.toString(),e!=top&&(this.highestUrl=s.referrer)}catch(t){}this.windows[this.encapsulationLevel]=s,i=e,e=e.parent}while(i!==t.window.top&&this.encapsulationLevel<n);this.window=this.windows[0],this.isHighestURLPage=!!(this.windows[this.encapsulationLevel]&&this.windows[this.encapsulationLevel].url||this.windows[this.encapsulationLevel-1]&&this.windows[this.encapsulationLevel-1].referrer),this.isInIframe=t.window!==t.window.top,this.hasTopAccess=!1;try{t.window.top.document&&(this.hasTopAccess=!0)}catch(t){}for(var o=0;o<this.windows.length;o++){var s=this.windows[o];s.url?s.url===this.highestUrl?this.urls[o]="adl_page":s.url===this.window.url?this.urls[o]="adl_iframe":this.urls[o]=s.url:o>0&&this.windows[o-1].referrer?this.windows[o-1].referrer==this.highestUrl?this.urls[o]="adl_page":this.windows[o-1].referrer===this.window.url?this.urls[o]="adl_iframe":this.urls[o]=this.windows[o-1].referrer:s.url==this.highestUrl?this.urls[o]="adl_page":s.url==this.window.url&&(this.urls[o]="adl_iframe"),o===this.windows.length-1&&s.referrer&&(s.referrer===this.highestUrl?this.refs[o]="adl_page":s.referrer===this.window.url&&(this.refs[o]="adl_iframe"))}}var n=100;t.exports=s},function(t,e,i){function s(){this.executionStart=Date.now(),this.version="2c546d8",this.window=window}var n=i(5);try{var o=i(8);s.prototype.getNode=function(){if(this.node)return this.node;if("currentScript"in this.window.document)return this.window.document.currentScript;for(var t=this.window.document.querySelectorAll('script[src*="//rs.adledge.com/aleagypkg"]'),e=0;e<t.length;e++){var i=t[e];if(!i.hasAttribute("aleown"))return i.setAttribute("aleown",""+e),i}},new o(new s)}catch(t){var r=n.data.flush.url,a={type:"agent",level:"fatal"};"message"in t&&(a.message=encodeURIComponent(t.message)),"stack"in t&&(a.stack=encodeURIComponent(t.stack)),"sendBeacon"in window.navigator?window.navigator.sendBeacon(r,JSON.stringify({log:[a]})):(r+="?d="+JSON.stringify({log:[a]}),(new Image).src=r)}},function(t,e,i){function s(t){try{this.metaController=a,this.environment=r,this.flushEvents={},this.session={timing:{sessionStart:Date.now(),agentExecutionStart:t.executionStart},log:[]},this.session.agent=t,this.session.agent.node=t.getNode(),this.session.id=this.session.agent.node&&this.session.agent.node.hasAttribute("tid")?this.session.agent.node.getAttribute("tid"):n.getUid(),a.sessions[this.session.id]=this.session,this.session.config=new d(this),this.session.data=new l(this),this.session.ivt=new c(this),this.session.data.set({bwr:{ua:{raw:r.browser.userAgent}},av:t.version,tid:this.session.id}),r.browser.name&&this.session.data.set({bwr:{n:r.browser.name}}),r.browser.version&&void 0!==r.browser.version.major&&this.session.data.set({bwr:{v:{ma:r.browser.version.major}}}),r.browser.userAgentInduced.version&&(void 0!==r.browser.userAgentInduced.version.major&&this.session.data.set({bwr:{ua:{v:{ma:r.browser.userAgentInduced.version.major}}}}),void 0!==r.browser.userAgentInduced.version.minor&&this.session.data.set({bwr:{ua:{v:{mi:r.browser.userAgentInduced.version.minor}}}})),r.hasTopAccess&&this.session.data.set("iid",a.id),a.subscribe({topic:"metaController:auid",context:this,callback:function(t){this.session.data.set("auid",t)},once:!0}),a.getAuid(this),this.session.data.set("fle",+!!r.browser.plugins.flash.enabled),r.browser.plugins.flash.enabled&&this.session.data.set("flv",r.browser.plugins.flash.version.raw),this.session.agent.context=new h(t),this.session.data.set("hurl",this.session.agent.context.highestUrl),this.session.agent.context.isInIframe&&this.session.data.set("iurl",this.session.agent.context.window.url),this.session.data.set({nbenc:this.session.agent.context.encapsulationLevel,ppup:+!!this.session.agent.context.isInPopup,sc:this.session.agent.context.hasTopAccess?2:0}),this.session.agent.context.urls.forEach(function(t,e){this.session.data.set("url"+e,t)},this),this.session.agent.context.refs.forEach(function(t,e){this.session.data.set("ref"+e,t)},this),a.subscribe({channel:this.session.id,topic:"ad:search:complete",context:this,callback:function(t){this.session.data.set("ads",t.getSize()),t.context.isUnderXDomain||(a.subscribe({channel:".*",topic:"ad:page:offset",context:this.session.ivt,callback:this.session.ivt.getStackedCreatives,async:!0}),t.getPageOffset())}}),a.barrier({channel:this.session.id,topics:["ad:search:complete","ad:measure:init"],context:this,callback:function(){this.session.config.current.ad.measure.enabled&&this.session.ad.measure()}}),a.subscribe({channel:this.session.id,topic:"ad:measure:first",context:this,callback:function(t){this.setFlushIteration()}}),a.subscribe({channel:this.session.id,topic:"ad:mask:set",context:this,callback:function(t,e){this.disableFlushIteration()}}),this.setFlushEventsListeners(),"prerender"===r.page.visibilityState?(this.log({type:"prerender"}),a.subscribe({topic:"page:visibility:change.*",context:this,callback:function(t){"prerender"!==t.visibilityState&&"unloaded"!==t.visibilityState&&(this.log({type:"afterPrerender",pageVisibilityState:r.page.visibilityState}),this.init())},once:!0})):this.init(),this.session.controller=this}catch(t){var e={data:{}};n.merge(e,this.session.config.current.data.flush.request),e.data.timing=n.merge(r.getPerformanceTiming(),this.session.timing,{dataFlush:Date.now()});var i={type:"controller",level:"fatal"};n.merge(i,t,{timeStamp:Date.now()}),this.session.log.push(i),e.data.log=this.session.log,this.session.data&&this.session.data.buffer&&n.merge(e.data,this.session.data.buffer),new o(this.session.config.current.data.flush.url,e)}}var n=i(0),o=i(3),r=i(2).getInstance(),a=i(1).getInstance(),h=i(6),c=i(9),d=i(10),l=i(11),u=i(12),p=i(13);s.prototype.init=function(){try{if(this.initialized)return;if(!this.session.agent.node)return void this.log({type:"agentNodeUndefined",level:"fatal"});try{this.session.config.getParams()}catch(t){return void this.log(t,{type:"configParamsFailure",level:"fatal"})}this.session.config.compute(),this.session.data.set("st",0),a.publish({channel:this.session.id,topic:"config:complete",data:this}),this.session.data.set("msk",this.session.config.current.brandSafety.mask.enabled?"0":"-1"),this.session.config.current.brandSafety.mask.enabled&&a.barrier({channel:this.session.id,topics:["ad:search:complete","brandSafety:status"],context:this,callback:function(){var t=this.session.ad,e=this.session.brandSafety;e.clientConfig.mask.status!==e.MASK_STATUS_DISABLED&&(t.mask.isSet||(t.disableMeasure(),t.applyMask()))}}),this.session.ad=new p(this),(this.session.config.current.brandSafety.mask.enabled||this.session.config.current.brandSafety.scan.enabled)&&(this.session.brandSafety=new u(this),this.session.brandSafety.isStatusDetermined()?a.publish({channel:this.session.id,topic:"brandSafety:status",data:this.session.brandSafety}):this.session.brandSafety.getStatus()),this.initialized=!0}catch(t){this.log(t,{type:"controllerInit",level:"fatal"})}},s.prototype.setTiming=function(t){return n.merge(this.session.timing,t)},s.prototype.log=function(t){for(var e={level:"info"},i=0;i<arguments.length;i++){var s=arguments[i],o={};"message"in s&&(o.message=s.message),"stack"in s&&(o.stack=s.stack),n.merge(e,s,o)}n.merge(e,{timeStamp:Date.now()}),this.session.log.push(e),a.publish({channel:this.session.id,topic:"log:"+e.level,data:e})},s.prototype.flushIterationLoop=function(){try{if(!this.session.config.current.data.flush.iteration.enabled)return;var t=this.flushIterationGetInterval(this.flushIterationIndex+1);void 0===t&&this.session.data.set({lp:"1",le:"iteration:last",dse:Date.now()-this.session.timing.agentExecutionStart}),this.session.data.flush({event:{type:"iteration:"+this.flushIterationIndex}}),void 0===t?this.disableFlush():(this.flushIterationIndex++,this.flushIterationTimeoutId=setTimeout(this.flushIterationLoop.bind(this),t))}catch(t){this.log(t,{type:"flushIterationLoop",level:"error"})}},s.prototype.setFlushIteration=function(){if(this.session.config.current.data.flush.iteration.enabled){this.flushIterationIndex=0,this.flushIterationGetInterval=new Function("n",this.session.config.current.data.flush.iteration.getInterval);var t=this.flushIterationGetInterval(0);t&&(this.flushIterationTimeoutId=setTimeout(this.flushIterationLoop.bind(this),t))}},s.prototype.disableFlushIteration=function(){this.session.config.current.data.flush.iteration.enabled=!1,clearTimeout(this.flushIterationTimeoutId),this.flushIterationGetInterval=new Function,a.publish({channel:this.session.id,topic:"data:flush:iteration:disabled",data:this})},s.prototype.disableFlush=function(){this.session.config.current.data.flush.enabled=!1,this.session.config.current.data.flush.iteration.enabled=!1,clearTimeout(this.flushIterationTimeoutId),this.flushIterationGetInterval=new Function,a.publish({channel:this.session.id,topic:"data:flush:disabled",data:this})},s.prototype.setFlushEventsListeners=function(){for(var t=this.session.id,e=this.session.config.current.data.flush.events,i=0,s=e.length;i<s;i++){var n=e[i];this.flushEvents[n]||("page:unload"===n?a.subscribe({channel:a.DEFAULT_CHANNEL,topic:"page:unload",context:this,callback:function(t,e){this.session.data.set({lp:"1",le:t.type,dse:Date.now()-this.session.timing.agentExecutionStart}),this.setTiming({pageUnload:Date.now()}),this.session.data.flush({event:{type:"page:unload",originalType:t.type},request:{type:"xhr",async:!1}}),this.session.config.current.data.flush.enabled=!1}}):a.subscribe({channel:t,topic:n,callback:function(t,e,i){this.session.data.flush({event:{type:t,originalType:e.type}})}.bind(this,n)}),this.flushEvents[n]=!0)}},t.exports=s},function(t,e,i){function s(t){this.environment=o;var e=this.session=t.session;this.config=e.config,e.data.set("iss",o.browser.hasAmbiguousClaims?"1":"0"),this.agentExecutionStartListComplete=!1,r.subscribe({channel:".*",topic:"ivt:init",context:this,callback:this.getAgentExecutionStartList,async:!0}),r.publish({channel:e.id,topic:"ivt:init",data:this})}var n=i(0),o=i(2).getInstance(),r=i(1).getInstance();s.prototype.getStackedCreatives=function(){var t=1;if(this.session.ad&&this.session.ad.object&&this.session.ad.object.node){for(var e in r.sessions)if(r.sessions.hasOwnProperty(e)){var i=r.sessions[e];if(e===this.session.id)continue;if(!(i.ad&&i.ad.object&&i.ad.object.node))continue;if(i.ad.object.node===this.session.ad.object.node)continue;i.ad.object.pageOffset.left===this.session.ad.object.pageOffset.left&&i.ad.object.pageOffset.top===this.session.ad.object.pageOffset.top&&t++}t>1&&this.session.data.set("occ",t)}},s.prototype.getAgentExecutionStartList=function(){var t=[],e=[],i=this.config.current.ivt.timingsListLimit;if(!this.agentExecutionStartListComplete){for(var s in r.sessions)if(r.sessions.hasOwnProperty(s)){var o=r.sessions[s];if(s===this.session.id)continue;(o.timing.agentExecutionStart<=this.session.timing.agentExecutionStart?t:e).push(o.timing.agentExecutionStart)}if(t.length||e.length){e=e.sort(n.compareNumbersAsc).slice(0,i),e.length>=i&&(this.agentExecutionStartListComplete=!0,r.unsubscribe({channel:".*",topic:"ivt:init",callback:this.getAgentExecutionStartList}));var a=t.sort(n.compareNumbersDesc).slice(0,i).concat(e);this.session.data.set("aesl",a)}}},t.exports=s},function(t,e,i){function s(t){this.controller=t,this.session=t.session,this.default=r,this.current=n.merge({},this.default)}var n=i(0),o=i(2).getInstance(),r=i(5);s.prototype.getParams=function(){var t={},e={};if(window[this.session.id])t=window[this.session.id];else{var i;if(this.session.agent.node.hasAttribute("alepar"))this.current.serializedParams=this.session.agent.node.getAttribute("alepar");else{var s=this.session.agent.node.getAttribute("src");if(!s)throw new Error("configParamsNoAgentNodeSrc");this.current.serializedParams=s.split("?")[1]}if(!this.current.serializedParams)throw new Error("configParamsNoSerialized");i=this.current.serializedParams.split("&");for(var n=0;n<i.length;n++){var o=i[n].split("=");o.length<2||(t[o[0]]=o.slice(1).join(""))}}for(var r in t)if(t.hasOwnProperty(r)){if("cs"===r)continue;switch(e[r]=t[r],typeof t[r]){case"string":t[r]=t[r].replace(/\//g,"");break;case"number":t[r]=""+t[r]}}return this.session.data.set("tps",e),this.params=t},s.prototype.compute=function(){var t={brandSafety:{},ad:{creative:{width:{},height:{}}}},e=this.session.agent.context.window.protocol;/^https?:/.test(e)?t.protocol=e:e=this.current.protocol,"0"!==this.params.fw&&"3815"!==this.params.cltid||(t.brandSafety.mask={enabled:!1}),this.params.sp&&"1"!==this.params.sp&&(t.brandSafety.scan={enabled:!1}),t.brandSafety.url=e+"//"+this.current.host.ser+this.current.brandSafety.webService.path;var i=e+"//"+("1"===this.params.vid||"3"===this.params.vid?this.current.host.vid:this.current.host.epn)+this.current.data.flush.path;if(i&&(t.data={flush:{url:i}},o.browser.is.ie&&o.browser.version.major<=10?t.data.flush.request={method:"get",type:"pixel"}:"sendBeacon"in this.session.agent.window.navigator&&(t.data.flush.request={method:"post",type:"sendBeacon",async:!0})),this.params.csz){var s=(this.params.csz.match(/(\d*)\D*(\d*)/)||[]).slice(1),r=s[0],a=s[1];r&&r>=this.current.ad.creative.width.min&&(t.ad.creative.width.clue=+s[0]),a&&a>=this.current.ad.creative.height.min&&(t.ad.creative.height.clue=+s[1])}else(this.params.wdt||this.params.hgt)&&(this.params.wdt&&this.params.wdt>=this.current.ad.creative.width.min&&(t.ad.creative.width.clue=+this.params.wdt),this.params.hgt&&this.params.hgt>=this.current.ad.creative.height.min&&(t.ad.creative.height.clue=+this.params.hgt));n.merge(this.current,t)},t.exports=s},function(t,e,i){function s(t){this.buffer={},this.session=t.session,this.config=this.session.config,this.sendCount={fail:0,success:0}}var n=i(0),o=i(3),r=i(2).getInstance(),a=i(1).getInstance();s.prototype.set=function(t,e){var i={};n.isObject(t)?i=t:i[t]=e;for(var s in i)if(i.hasOwnProperty(s))for(var o in this.config.current.data.truncation)if(this.config.current.data.truncation.hasOwnProperty(o)){var r=this.config.current.data.truncation[o],a=new RegExp(o);a.test(s)&&i[s].length>r&&(i[s]=n.truncate(i[s],r))}n.merge(this.buffer,i)},s.prototype.flush=function(t){if(this.config.current.data.flush.enabled){t||(t={}),t.event&&t.event.type&&(this.flushEvent=t.event.type);var e={fe:this.flushEvent,avc:Object.keys(r.window.adlgdrgn).length,ac:Object.keys(a.sessions).length},i=n.merge(r.getPerformanceTiming(),this.session.timing,{dataFlush:Date.now()});n.merge(e,this.buffer,{timing:i}),this.session.log.length&&n.merge(e,this.buffer,{log:this.session.log}),this.session.beacon=this.serialize(e);var s=n.merge({},this.config.current.data.flush.request,t.request,{data:this.session.beacon,context:this});new o(this.config.current.data.flush.url,s,this.onSent),a.publish({channel:this.session.id,topic:"data:flush",data:this})}},s.prototype.serialize=function(t){if(t)return this.session.ad&&this.session.ad.measures&&(t.msr=this.serializeMeasures(this.session.ad.measures)),t},s.prototype.serializeMeasures=function(t){for(var e=[],i=0,s=t.length;i<s;i++){var o=t[i],r=t[i+1],a=o.viewablePercentage+"-"+(o.pageIsVisible?"1":"0")+"-"+n.floor10((o.timeStamp-this.session.timing.adMeasureFirst)/1e3).toFixed(1);r?r.timeStamp-o.timeStamp>150&&(a+="-"+n.floor10((r.timeStamp-this.session.timing.adMeasureFirst-100)/1e3).toFixed(1)):a+="-"+n.floor10((Date.now()-this.session.timing.adMeasureFirst)/1e3).toFixed(1),e.push(a)}return e.join("_")},s.prototype.onSent=function(t,e){t?(this.set({fc:{f:++this.sendCount.fail},ffr:e.toJSON()}),"sendBeacon"===t.type&&(this.config.current.data.flush.request.type="xhr",this.flush())):this.set({fc:{s:++this.sendCount.success}})},t.exports=s},function(module,exports,__webpack_require__){function BrandSafety(t){this.URL_STATUS_UNKNWON=0,this.URL_STATUS_PROPER=1,this.URL_STATUS_IMPROPER=2,this.URL_STATUS_NORMAL=3,this.URL_STATUS_ADSERVER=4,this.MASK_STATUS_ENABLED="true",this.MASK_STATUS_DISABLED="false",this.controller=t;var e=this.session=t.session,i=this.config=e.config;this.context=e.agent.context,metaController.clients[i.params.cltid]||(metaController.clients[i.params.cltid]={}),metaController.clients[i.params.cltid].brandSafety||(metaController.clients[i.params.cltid].brandSafety={url:{},mask:{},analyse:{count:0}}),this.clientConfig=metaController.clients[i.params.cltid].brandSafety,this.wsResponse={}}var Utils=__webpack_require__(0),Request=__webpack_require__(3),environment=__webpack_require__(2).getInstance(),metaController=__webpack_require__(1).getInstance();BrandSafety.prototype.isStatusDetermined=function(){return this.wsResponse.s==this.URL_STATUS_PROPER||this.wsResponse.s==this.URL_STATUS_IMPROPER||this.wsResponse.s==this.URL_STATUS_NORMAL&&this.wsResponse.m==this.MASK_STATUS_ENABLED},BrandSafety.prototype.getStatus=function(){var data={u:this.context.highestUrl,c:this.config.params.cltid};this.context.isHighestURLPage||(data.itu=0,data.iu=this.context.window.url),new Request(this.config.current.brandSafety.url,{method:"get",type:"xhr",async:!0,data:data,accept:"text/plain",context:this},function(err,request){try{if(err)throw err;if(request.response.split("&").map(function(t){return t.split("=")}).forEach(function(t){this.wsResponse[t[0]]=t[1]},this),!this.wsResponse.s||!this.wsResponse.m)throw new Error("missingParams");if(this.session.data.set("wss",this.wsResponse.s),this.clientConfig.url={status:eval(this.wsResponse.s),extracted:this.wsResponse.exu,extractedFrom:this.wsResponse.exus},this.clientConfig.url.extracted&&(this.context.highestUrl=this.clientConfig.url.extracted,this.session.data.set({hurl:this.clientConfig.url.extracted,iexu:"1",exus:this.clientConfig.url.extractedFrom})),this.isStatusDetermined())return this.clientConfig.mask.status=this.wsResponse.m,void metaController.publish({channel:this.controller.session.id,topic:"brandSafety:status",data:this});if(!this.config.current.brandSafety.scan.enabled||!environment.hasTopAccess)return void(this.context.isHighestURLPage||this.clientConfig.url.extracted||"2"!==this.config.params.fw||(this.clientConfig.mask.status=this.MASK_STATUS_ENABLED,metaController.publish({channel:this.controller.session.id,topic:"brandSafety:status",data:this})));environment.page.isLoaded?(environment.getPageText(),this.analyse()):metaController.barrier({channel:this.session.id,topics:["page:load"],context:this,timeout:this.config.current.brandSafety.getPageTextTimeout,callback:function(){this.clientConfig.analyse.count||(environment.getPageText(),this.analyse())}})}catch(t){this.controller.log(t,{type:"brandSafetyGetStatus",level:"error",response:request.response})}})},BrandSafety.prototype.getKeywordsList=function(){var t=[];switch(this.config.params.cltid){case"3848":case"3877":t.push(this.keywordsLists.affiperfFR);break;case"3897":t.push(this.keywordsLists.emirates);break;case"3942":t.push(this.keywordsLists.bnp);break;case"3814":Utils.inArray(["144092","bnp","4134870","hellobank"],this.config.params.advid)&&t.push(this.keywordsLists.bnp)}return t.push(this.keywordsLists.common),t},BrandSafety.prototype.analyse=function(){environment.page.text&&(this.clientConfig.analyse.status="running",this.clientConfig.analyse.count++,new Request(this.config.current.protocol+"//"+this.config.current.host.cdn+"/brandSafety.json",{method:"get",type:"xhr",async:!0,accept:"application/json",responseType:"json",context:this},function(t,e){try{if(t)throw t;this.keywordsLists=e.response;(this.clientConfig.keywordsList=this.getKeywordsList()).some(function(t){for(var e in t){var i=t[e];if(!(environment.page.text.indexOf(e)<0)){if(new RegExp(i||"\\b"+e+"\\b").test(environment.page.text))return this.session.data.set("kw",this.clientConfig.badKeyword=e),(Utils.inArray(this.config.current.brandSafety.apriori,this.config.params.cltid)||"2"===this.config.params.fw)&&metaController.publish({channel:this.controller.session.id,topic:"brandSafety:status",data:this}),!0}}},this),this.clientConfig.analyse.status="complete"}catch(t){this.controller.log(t,{type:"brandSafetyAnalyse",level:"error"})}}))},module.exports=BrandSafety},function(t,e,i){function s(t){this.controller=t;var e=this.session=t.session;this.agent=e.agent,this.config=e.config,this.tag=e.tag,this.type=n.inArray([p,g,f],e.config.params.vid)?"video":"display",this.container={},this.creative={},this.mask={},this.creativeNodesFilter=this.creativeNodesFilterFactory(),this.measures=[],this.iab={requirement:{},measure:{}},this.previous={pageIsVisible:r.page.isVisible},this.viewable={},this.viewability=this.viewabilityFactory(),this.viewability||this.controller.log({type:"adNoGetViewabilityMethod",level:"error"}),this.searchCount=0,this.search()}var n=i(0),o=i(4),r=i(2).getInstance(),a=i(1).getInstance(),h=i(6),c=i(14),d=i(15),l=i(16),u=i(17),p="1",g="3",f="4";s.prototype.viewabilityFactory=function(){return!this.agent.context.isUnderXDomain||document.body.fireEvent?d:"IntersectionObserver"in window?c:"mozInnerScreenX"in window?d:r.browser.is.ie||r.browser.is.edge&&r.browser.userAgentInduced.version.major<=13?l:r.browser.is.safari?u:void 0},s.prototype.creativeNodesFilterFactory=function(){return"video"===this.type?this.videoCreativeNodesFilter:this.displayCreativeNodesFilter},s.prototype.displayCreativeNodesFilter=function(t){if(t){var e=t.getBoundingClientRect&&t.getBoundingClientRect();if(e&&!(e.width<this.config.current.ad.creative.width.min||e.width>this.config.current.ad.creative.width.max||e.height<this.config.current.ad.creative.height.min||e.height>this.config.current.ad.creative.height.max)){if(this.config.params.pty){if(!t.hasAttribute(this.config.params.pty))return;var i=t.getAttribute(this.config.params.pty);if(!i)return;if(!this.config.params.vle)return;if(i!==this.config.params.vle)return}if(!(this.config.current.ad.creative.width.clue&&Math.abs(e.width-this.config.current.ad.creative.width.clue)>10||this.config.params.mwdt&&e.width<this.config.params.mwdt||this.config.current.ad.creative.height.clue&&Math.abs(e.height-this.config.current.ad.creative.height.clue)>10||this.config.params.mhgt&&e.height<this.config.params.mhgt))return!0}}},s.prototype.videoCreativeNodesFilter=function(t){if(t){var e=t.getBoundingClientRect&&t.getBoundingClientRect();if(e&&!(e.width<this.config.current.ad.creative.width.min||e.width>this.config.current.ad.creative.width.max||e.height<this.config.current.ad.creative.height.min||e.height>this.config.current.ad.creative.height.max)){if("1"==this.config.params.vid||"2"==this.config.params.vid){if(!this.config.params.pty)return;if(!t.hasAttribute(this.config.params.pty))return;if(!t.getAttribute(this.config.params.pty))return}if(!(this.config.params.mwdt&&e.width<this.config.params.mwdt||this.config.params.mhgt&&e.height<this.config.params.mhgt))return!0}}},s.prototype.search=function(){try{var t,e,i=[];if(this.session.data.set("asc",++this.searchCount),1===this.searchCount&&(this.controller.setTiming({adSearchStart:Date.now()}),a.publish({channel:this.controller.session.id,topic:"ad:search:start",data:this})),this.config.params.ctrel)this.container.node=this.config.params.ctrel;else if(this.config.params.ctrsel){try{i=this.agent.context.window.object.document.querySelectorAll(this.config.params.ctrsel),0===i.length&&this.agent.context.hasTopAccess&&(i=r.window.document.querySelectorAll(this.config.params.ctrsel))}catch(t){return void this.controller.log(t,{type:"adSearchCtrselSelector",level:"fatal"})}if(1!==i.length&&this.searchCount>=this.config.current.ad.search.count.max)return void this.controller.log({type:"adSearchCtrselSelector",level:"fatal",message:"ctrsel selector '"+this.config.params.ctrsel+"' provided "+i.length+" results"});this.container.node=i[0]}else{if(this.searchContainer(),!this.container.node){if(this.agent.context.isInIframe&&this.agent.node&&this.agent.node.parentNode&&"head"===this.agent.node.parentNode.tagName.toLowerCase()){if(this.searchCount<this.config.current.ad.container.search.count.max)return void setTimeout(this.search.bind(this),this.config.current.ad.container.search.interval);this.controller.log({type:"adSearchContainerFailure",level:"error"})}this.container.node=this.agent.node.parentNode}"head"===this.container.node.tagName.toLowerCase()&&(this.container.node=this.agent.window.document.body)}if(this.config.params.ctvel)e=[this.config.params.ctvel];else if(this.config.params.ctvsel){try{e=(this.container.node||this.agent.context.window.object.document).querySelectorAll(this.config.params.ctvsel),0===e.length&&this.agent.context.hasTopAccess&&(e=r.window.document.querySelectorAll(this.config.params.ctvsel))}catch(t){return void this.controller.log(t,{type:"adSearchCtvselSelector",level:"fatal"})}if(1!==e.length&&this.searchCount>=this.config.current.ad.search.count.max)return void this.controller.log({type:"adSearchCtvselSelector",level:"fatal",message:"ctvsel selector '"+this.config.params.ctvsel+"' provided "+e.length+" results"})}else e=(this.container.node||this.agent.context.window.object.document).querySelectorAll(this.config.current.ad.creative[this.type].selector);var s=Array.prototype.slice.call(e).filter(this.creativeNodesFilter,this);if(!s.length&&this.agent.context.hasTopAccess&&this.agent.context.isInIframe&&!this.agent.context.isUnderXDomain){var c=o.getRect(this.agent.window.frameElement),d=r.window.document.createTreeWalker(r.window.document.body,NodeFilter.SHOW_ELEMENT,function(t){if(t===this.agent.window.frameElement||!n.matchesSelector(t,this.config.current.ad.creative[this.type].selector))return NodeFilter.FILTER_SKIP;var e=o.getRect(t);return o.equals(c,e,2)?NodeFilter.FILTER_ACCEPT:void 0}.bind(this),!1);d.nextNode()&&(s=[d.currentNode].filter(this.creativeNodesFilter,this))}s.length&&(this.creative.node=s[0],t=this.creative,t.config=this.config.current.ad.creative),t?(this.object=t,this.window=t.node.ownerDocument.defaultView,this.context=this.window===this.agent.window?this.agent.context:new h(this),this.session.ad=this,this.viewability&&this.viewability.init.apply(this),this.controller.setTiming({adSearchComplete:Date.now()}),a.publish({channel:this.controller.session.id,topic:"ad:search:complete",data:this})):this.searchCount<this.config.current.ad.search.count.max?setTimeout(this.search.bind(this),this.config.current.ad.search.interval):this.controller.log({type:"adSearchFailure",level:"error"})}catch(t){this.controller.log(t,{type:"adSearch",level:"error"})}},s.prototype.searchContainer=function(){var t=[];for(var e in a.sessions)if(a.sessions.hasOwnProperty(e)){var i=a.sessions[e];i.ad&&i.ad.container.node&&t.push(i.ad.container.node)}var s=document.body.getElementsByTagName("script");if(s.length&&(s=Array.prototype.slice.call(s)),window[this.session.id])if(this.config.params.cs&&n.inArray(s,this.config.params.cs))this.container.node=this.config.params.cs.parentNode;else if(this.config.params.co){var o=new RegExp("aleagypkganch "+this.session.id),r=function(e){if(o.test(e.nodeValue)&&!n.inArray(t,e))return NodeFilter.FILTER_ACCEPT},h=document.createTreeWalker(document.body,NodeFilter.SHOW_COMMENT,r,!1);h.nextNode()&&(this.container.node=h.currentNode.parentNode)}else{var c=new RegExp("cpgids*:[s'\"]*"+this.config.params.cpgid,"i"),d=!1;this.config.params.pctid&&(d=new RegExp("pctid *:[ '\"]*"+this.config.params.pctid,"i"));for(var l=0;l<s.length;l++){var u=s[l],p=u.innerHTML;if(p.length>0&&p.length<this.config.current.ad.container.search.scriptTextLength.max&&p.indexOf("aleagypkganch")>0&&c.test(p)&&(!d||d.test(p))&&!n.inArray(t,u)){this.container.node=u.parentNode;break}}}else for(var l=0;l<s.length;l++){var u=s[l],p=u.innerHTML;if(p.length>0&&p.length<this.config.current.ad.container.search.scriptTextLength.max&&this.config.current.serializedParams&&p.indexOf(this.config.current.serializedParams)>0&&!n.inArray(t,u)){this.container.node=u.parentNode;break}}},s.prototype.measure=function(){try{if(!this.session.config.current.ad.measure.enabled)return;if(r.browser.is.ie&&(!this.object.node||!this.object.node.parentNode))return;var t=Date.now();if(this.measureStart||(this.measureStart=t,this.controller.setTiming({adMeasureStart:this.measureStart}),a.publish({channel:this.controller.session.id,topic:"ad:measure:start",data:this})),this.viewability.get.apply(this),n.isInt(this.viewable.percentage)){var e=!1;r.page.isVisible!==this.previous.pageIsVisible&&(r.page.isVisible?("number"==typeof this.previous.viewablePercentage&&(this.viewable.percentage=this.previous.viewablePercentage),this.previous.viewablePercentage=0):(this.previous.viewablePercentage=this.viewable.percentage,this.viewable.percentage=0),this.previous.pageIsVisible=r.page.isVisible,e=!0),r.page.isVisible&&this.viewable.percentage!==this.previous.viewablePercentage&&(this.previous.viewablePercentage=this.viewable.percentage,e=!0),e&&(this.previous.timeStamp=t,this.measures.push({viewablePercentage:this.viewable.percentage,pageIsVisible:r.page.isVisible,timeStamp:t}),a.publish({channel:this.controller.session.id,topic:"ad:viewability:change",data:this})),this.measures.length&&(this.measureFirst||(this.measureFirst=t,this.controller.setTiming({adMeasureFirst:this.measureFirst}),a.publish({channel:this.controller.session.id,topic:"ad:measure:first",data:this}),this.getRect(),this.area=this.object.rect.getArea(),this.format=this.area>=this.config.current.ad.measure.iab[this.type].large.pixels.threshold?"large":"standard",this.iab.requirement.percentage=this.config.current.ad.measure.iab[this.type][this.format].pixels.percentage.min,this.iab.requirement.duration=this.config.current.ad.measure.iab[this.type][this.format].duration.min),this.viewable.percentage>=this.iab.requirement.percentage&&r.page.isVisible?this.iab.measure.timeStamp||(this.iab.measure.timeStamp=t):delete this.iab.measure.timeStamp,!this.iab.measure.taken&&this.iab.measure.timeStamp&&t-this.iab.measure.timeStamp>=this.iab.requirement.duration&&(this.iab.measure.taken=!0,this.controller.setTiming({adViewabilityIab:t}),a.publish({channel:this.controller.session.id,topic:"ad:viewability:iab",data:this})))}this.measureTimeoutId=setTimeout(this.measure.bind(this),this.config.current.ad.measure.interval)}catch(t){this.controller.log(t,{type:"adMeasure",level:"error"})}},s.prototype.disableMeasure=function(){this.session.config.current.ad.measure.enabled=!1,clearTimeout(this.measureTimeoutId)},s.prototype.getRect=function(){return this.object.rect=o.getRect(this.object.node)},s.prototype.getSize=function(){var t=this.getRect();if(t.width&&t.height)return Math.round(t.width)+"x"+Math.round(t.height)},s.prototype.getPageOffset=function(){for(var t=this.getRect(),e=0;e<this.context.windows.length;e++){var i=this.context.windows[e].object;try{var s=i.document.body,n=i.document.documentElement,o=i.pageXOffset||n.scrollLeft||s.scrollLeft,r=i.pageYOffset||n.scrollTop||s.scrollTop,h=n.clientLeft||s.clientLeft||0,c=n.clientTop||s.clientTop||0;if(t.left+=o-h,t.top+=r-c,i.frameElement){var d=i.frameElement.getBoundingClientRect();t.left+=d.left,t.top+=d.top}}catch(t){}}this.object.pageOffset={left:Math.round(t.left),top:Math.round(t.top)},this.session.data.set({psx:this.object.pageOffset.left,psy:this.object.pageOffset.top}),a.publish({channel:this.session.id,topic:"ad:page:offset",data:this})},s.prototype.applyMask=function(){"video"===this.type?this.agent.context.window.object.postMessage(JSON.stringify({channel:this.session.id,topic:"ad:mask:apply",timeStamp:Date.now()}),"*"):(this.mask.node=document.createElement("div"),this.getRect(),this.mask.node.style.width=this.object.rect.width+"px",this.mask.node.style.height=this.object.rect.height+"px",this.object.node.parentNode.replaceChild(this.mask.node,this.object.node)),this.mask.isSet=!0,this.session.data.set("msk","1"),this.controller.setTiming({adMaskSet:Date.now()}),a.publish({channel:this.controller.session.id,topic:"ad:mask:set",data:this})},t.exports=s},function(t,e,i){var s=i(4),n=i(1).getInstance();e.init=function(){this.getViewabilityName="io",this.session.data.set("mtd",this.getViewabilityName);var t=new IntersectionObserver(function(t){var e=t[0];this.object.rect=new s(e.boundingClientRect),this.viewable.percentage=Math.round(100*e.intersectionRatio)}.bind(this),{threshold:[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1]});this.session.data.set("st",400),n.subscribe({channel:this.session.id,topic:"ad:search:complete",context:this,callback:function(){this.viewable.percentage=0,t.observe(this.object.node)}}),this.controller.setTiming({adMeasureInit:Date.now()}),n.publish({channel:this.controller.session.id,topic:"ad:measure:init",data:this})},e.get=function(){return this.viewable.percentage}},function(t,e,i){var s=i(0),n=i(4),o=i(2).getInstance(),r=i(1).getInstance(),a={firefox:{X:0,Y:79},ie:{X:8,Y:70},edge:{X:16,Y:93}};e.init=function(){this.getViewabilityName="pg",this.session.data.set("mtd",this.getViewabilityName),this.topViewportOffset={X:0,Y:0},this.session.data.set("st",400),this.controller.setTiming({adMeasureInit:Date.now()}),r.publish({channel:this.controller.session.id,topic:"ad:measure:init",data:this})},e.get=function(){var t=this.window.document.documentElement;this.context.hasTopAccess&&o.window.outerWidth>=o.window.innerWidth&&o.window.outerHeight>=o.window.innerHeight?(this.topViewportOffset.X=o.window.outerWidth-o.window.innerWidth,this.topViewportOffset.Y=o.window.outerHeight-o.window.innerHeight):o.browser.name in a&&(this.topViewportOffset.X=a[o.browser.name].X,this.topViewportOffset.Y=a[o.browser.name].Y);var e,i=o.getScreenRect(),r=o.getAppRect(),h={left:r.left+this.topViewportOffset.X,top:r.top+this.topViewportOffset.Y,right:r.right,bottom:r.bottom,width:r.width,height:r.height},c=n.getIntersectionRect(i,h);if(this.context.isInIframe)if(this.context.isUnderXDomain)"mozInnerScreenX"in this.window?e={left:this.window.mozInnerScreenX,top:this.window.mozInnerScreenY,right:this.window.mozInnerScreenX+this.window.innerWidth,bottom:this.window.mozInnerScreenY+this.window.innerHeight,width:this.window.innerWidth,height:this.window.innerHeight}:this.window.document.body.fireEvent&&(!this.ieAttachedEvent&&this.window.document.body.attachEvent("onmousemove",function(t){this.ieEventLeft=t.screenX-t.clientX,this.ieEventTop=t.screenY-t.clientY,this.ieAttachedEvent=!0}.bind(this)),this.window.document.body.fireEvent("onmousemove"),e={left:this.ieEventLeft||0,top:this.ieEventTop||0,right:this.ieEventLeft+this.window.innerWidth||0,bottom:this.ieEventTop+this.window.innerHeight||0,width:this.window.innerWidth,height:this.window.innerHeight});else{var d=this.window.frameElement.getBoundingClientRect();e={left:this.window.screenX+this.topViewportOffset.X+d.left,top:this.window.screenY+this.topViewportOffset.Y+d.top,right:this.window.screenX+this.topViewportOffset.X+d.right,bottom:this.window.screenY+this.topViewportOffset.Y+d.bottom,width:d.width||d.right-d.left,height:d.height||d.bottom-d.top}}else e={left:this.window.screenX+this.topViewportOffset.X,top:this.window.screenY+this.topViewportOffset.Y,right:this.window.screenX+this.window.innerWidth+this.topViewportOffset.X,bottom:this.window.screenY+this.window.innerHeight+this.topViewportOffset.Y,width:this.window.innerWidth,height:this.window.innerHeight};var l=n.getIntersectionRect(c,e);l.left-=this.window.screenX,l.top-=this.window.screenY,l.right-=this.window.screenX,l.bottom-=this.window.screenY,l.right-=this.topViewportOffset.X,l.bottom-=this.topViewportOffset.Y,l.left-=this.topViewportOffset.X,l.top-=this.topViewportOffset.Y,this.context.isInIframe&&(l.right-=l.left,l.bottom-=l.top,l.left=-l.left,l.top=-l.top);var u={left:0,top:0,right:t.clientWidth,bottom:t.clientHeight,width:t.clientWidth,height:t.clientHeight},p=n.getIntersectionRect(l,u);if(!s.contains(t,this.object.node))return this.viewable.percentage=0;if(!this.object.node.offsetWidth||!this.object.node.offsetHeight)return this.viewable.percentage=0;this.getRect(),this.area=this.object.rect.width*this.object.rect.height;var g=n.getIntersectionRect(this.object.rect,p);if(0==(this.viewable.area=Math.max(g.width*g.height,0)))return this.viewable.percentage=0;var f={X:1,Y:1},m={leftTop:{x:g.left+f.X,y:g.top+f.Y},rightTop:{x:g.right-f.X,y:g.top+f.Y},rightBottom:{x:g.right-f.X,y:g.bottom-f.Y},leftBottom:{x:g.left+f.X,y:g.bottom-f.Y}},w=[],b=[];for(var v in m){var y=m[v],x=document.elementFromPoint(y.x,y.y);if(x&&x!=this.object.node&&!(s.getOpacity(x)<.3)&&!(w.indexOf(x)>-1)){var S=x.getBoundingClientRect(),A=n.getIntersectionRect(g,S),I=A.width*A.height;this.viewable.area-=I;for(var E=0,T=b.length;E<T;E++){var R=b[E];this.viewable.area+=n.getIntersectionArea(A,R)}w.push(x),b.push(A)}}return this.viewable.percentage=Math.round(100*this.viewable.area/this.area)}},function(t,e,i){var s=i(1).getInstance();e.init=function(){this.getViewabilityName="efp",this.session.data.set("mtd",this.getViewabilityName),this.session.data.set("st",400),this.controller.setTiming({adMeasureInit:Date.now()}),s.publish({channel:this.controller.session.id,topic:"ad:measure:init",data:this})},e.get=function(){for(var t=this.getRect(),e=0,i=t.width/10,s=t.height/10,n=t.left+i/2,o=t.top+s/2;n<=t.right;n+=i,o+=s)this.window.document.elementFromPoint(n,o)&&(e+=10);return this.viewable.percentage=e}},function(t,e,i){function s(t){try{var e=Date.now();if((t.origin||t.originalEvent.origin)!==o)return;if(!r.isObject(t.data)||"adledge"!==t.data.channel||"ad:viewability:ipx"!==t.data.topic)return;var i=t.data.i,s=this.iframePixels[i];if(!s)return;var n=e-s.latestTimeStamp;if(s.viewable=n>l?0:1,s.latestTimeStamp=s.timeStamp,s.timeStamp=e,s.activated=!0,u)return;for(var c=0,d=0,p=this.iframePixels.length;d<p;d++)this.iframePixels[d].activated&&c++;this.session.data.set("vmp",{activated:c,total:h}),c===h&&(u=!0,this.session.data.set("st",400),this.controller.setTiming({adMeasureInit:Date.now()}),a.publish({channel:this.controller.session.id,topic:"ad:measure:init",data:this}))}catch(t){}}function n(){for(var t=this.getRect(),e=t.left+pageXOffset,i=t.top+pageYOffset,s=0;s<h;s++){var n,o,r=this.iframePixels[s],a=r.node;switch(s){case 0:n=e,o=i;break;case h-1:n=e+t.width-c,o=i+t.height-d;break;default:n=Math.round(e+s*(t.width/(h-1))-c/2),o=Math.round(i+s*(t.height/(h-1))-d/2)}r.left=n,r.top=o,a&&(a.style.left=n+"px",a.style.top=o+"px")}}var o,r=i(0),a=i(1).getInstance(),h=10,c=1,d=1,l=100,u=!1;e.init=function(){this.getViewabilityName="it",this.session.data.set("mtd",this.getViewabilityName),this.iframePixels=[],this.window.addEventListener("message",s.bind(this),!1);var t=/^http/.test(this.agent.context.window.protocol)?this.agent.context.window.protocol:this.config.current.protocol;o=t+"//"+this.config.current.host.vpx;for(var e=o+"/iframepix.html#",i=0;i<h;i++){var r=Date.now(),l={node:document.createElement("iframe"),viewable:0,timeStamp:r,latestTimeStamp:r};l.node.width=c,l.node.height=d,l.node.frameborder=0,l.node.allowtransparency=!0,l.node.src=e+i,l.node.style.position="absolute",l.node.style.left="0px",l.node.style.top="0px",l.node.style.border="0 none",this.iframePixels.push(l),this.window.document.body.appendChild(l.node)}this.session.data.set("vmp",{activated:0,total:h}),a.subscribe({topic:"page:visibility:change.*",context:this,callback:function(t){if(t.isHidden)for(var e=0,i=this.iframePixels.length;e<i;e++){var s=this.iframePixels[e];s.viewable=0,s.node.style.left="-9999px"}else n.apply(this)}}),a.subscribe({channel:this.session.id,topic:"ad:search:complete",context:this,callback:n.bind(this)})},e.get=function(){for(var t=0,e=Date.now(),i=0;i<h;i++){var s=this.iframePixels[i];(e-s.timeStamp>l||document.hidden)&&(s.viewable=0),t+=s.viewable}return this.viewable.percentage=Math.round(100*t/h)}}]);